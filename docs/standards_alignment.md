# SIR Firewall – Standards & Governance Alignment (Round 3)

This document explains how SIR’s pre-inference firewall, Domain ISC packs, and audit artefacts map to common governance and assurance frameworks.

## 1. Core architecture

**Component:** SIR pre-inference firewall (`sir_firewall`)

- **What it does:** Enforces policy on a structured ISC envelope before any prompt is sent to the model.
- **Key properties:**
  - Deterministic, pure-rule Python — no training, no heuristics, no side channels.
  - Fail-closed on malformed ISC or disallowed templates.
  - Obfuscation normalisation and 2025 jailbreak pattern checks.

**Standards hooks:**

- **EU AI Act:** fits the “technical measures and controls” requirement for high-risk systems (Article 15 / logging and technical robustness).
- **NIST AI RMF:** sits in the “Govern” and “Measure” functions as a pre-inference control surface.
- **ISO/IEC 42001 (AI management systems):** implements a concrete control for policy-driven prompt handling.

## 2. Domain ISC packs (HIPAA, PCI, generic)

**Component:** Domain ISC packs (`src/sir_firewall/policy/isc_packs/*.json`)

- `generic_safety.json` – baseline jailbreak + high-risk content firewall.
- `hipaa_mental_health.json` – tuned for PHI and mental health workloads.
- `pci_payments.json` – tuned for payment card / PCI-style workloads.

Each pack defines:

- `pack_id` – the domain name stamped into every decision.
- `templates.max_tokens` – per-template friction caps (rough token limits).
- `flags`:
  - `STRICT_ISC_ENFORCEMENT`
  - `CHECKSUM_ENFORCED`
  - `CRYPTO_ENFORCED` (ready for RSA enforcement when keys are wired).

At runtime, `validate_sir`:

- Loads the active pack based on `SIR_ISC_PACK` (or defaults to `generic_safety`).
- Applies the pack’s friction + enforcement flags.
- Returns `domain_pack` in every result and records it in the ITGL ledger.

**Standards hooks:**

- **HIPAA / PHI:** `hipaa_mental_health` makes ISC handling and friction limits explicit for PHI workloads.
- **PCI DSS:** `pci_payments` constrains payment templates and can be referenced as a named control in PCI documentation.
- **EU AI Act / sectoral law:** pack IDs can be mapped to specific risk classes / domains in the organisation’s AI inventory.

## 3. ITGL ledger (hash-chained runtime log)

**Component:** ITGL ledger (`proofs/itgl_ledger.jsonl` from `red_team_suite.py`)

Each decision chain includes:

- Timestamp and component steps (`isc_structure`, `crypto_checksum`, `friction`, `jailbreak`, `final`).
- The active `domain_pack` (HIPAA / PCI / generic).
- Inputs/outputs per step, plus a hash that chains each entry to the previous one.

**Standards hooks:**

- **EU AI Act logging:** satisfies auditability/logging requirements for high-risk systems by providing a tamper-evident, step-level log.
- **NIST AI RMF – Measure:** provides structured evidence for red-team runs and production behaviour.
- **Assurance / insurance:** supports post-incident reconstruction and independent verification that the correct domain pack governed each decision.

## 4. Signed audit certificates (CI)

**Component:** Signed audit (`proofs/latest-audit.json` + `proofs/latest-audit.html`)

Generated by `tools/generate_certificate.py` from CI red-team runs.

The signed JSON payload includes:

- `prompts_tested`
- `jailbreaks_leaked`
- `harmless_blocked`
- `date`
- `model` / `provider`
- `repository` / `commit_sha`
- `ci_run_url`
- **Round 3 fields:** `domain_pack`, `suite_path`
- `payload_hash` (sha256) and an RSA signature (`signature`)

The HTML view (`proofs/latest-audit.html`) is just a thin UI over `latest-audit.json`.

**Standards hooks:**

- **EU AI Act / NIST AI RMF:** gives a verifiable snapshot of the model + policy + domain pack that passed the latest jailbreak suite.
- **ISO/IEC 42001:** can be attached as evidence for control implementation and monitoring.
- **Insurability:** provides a machine-verifiable artefact that a specific model + domain pack combination was tested against a known suite, with no leaks.

## 5. How to cite SIR in governance documents

When describing SIR in internal policies, you can refer to it as:

> “A pre-inference firewall (SIR) that enforces Domain ISC packs (HIPAA / PCI / generic) before any prompt reaches the model. Every decision is logged into a hash-chained ITGL ledger, and CI red-team runs produce RSA-signed audit certificates that bind the active domain pack and test suite into a verifiable payload.”

Pointers:

- Core firewall: `src/sir_firewall/core.py`
- Domain ISC packs: `src/sir_firewall/policy/isc_packs/`
- ITGL ledger: `proofs/itgl_ledger.jsonl`
- Signed audit: `proofs/latest-audit.json` + `proofs/latest-audit.html`
- CI entrypoint: `red_team_suite.py` + `tools/generate_certificate.py`
