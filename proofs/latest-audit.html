<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SIR Firewall – Pre-Inference Governance Audit</title>
  <meta name="description" content="Cryptographically verifiable pre-inference governance audit certificate for SIR Firewall." />
  <style>
    :root { --success: #56d364; --danger: #f85149; --bg: #0d1117; --card: #161b22; --border: #30363d; --text: #c9d1d9; --muted: #8b949e; --link: #58a6ff; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; max-width: 920px; margin: 40px auto; padding: 20px; background: var(--bg); color: var(--text); line-height: 1.6; }
    h1 { color: var(--link); text-align: center; margin-bottom: 0.2em; }
    .subtitle { text-align: center; color: var(--muted); font-size: 1.05em; margin-bottom: 28px; }
    .badge { font-size: 120px; text-align: center; margin: 28px 0 10px; font-weight: 800; letter-spacing: -2px; }
    .success { color: var(--success); }
    .danger { color: var(--danger); }
    .box { background: var(--card); padding: 22px; border-radius: 12px; border: 1px solid var(--border); margin: 18px 0; }
    a { color: var(--link); text-decoration: none; }
    a:hover { text-decoration: underline; }
    .mono { font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace; }
    .verify { background: #0d1117; padding: 12px; border-radius: 8px; overflow-x: auto; display: inline-block; }
    footer { margin-top: 70px; text-align: center; font-size: 0.9em; color: var(--muted); }
    .row { display: grid; grid-template-columns: 190px 1fr; gap: 10px; }
    .k { color: var(--muted); }
    .wrap { word-break: break-word; }
    .pill { display: inline-block; padding: 2px 8px; border: 1px solid var(--border); border-radius: 999px; font-size: 0.85em; color: var(--muted); margin-left: 8px; }
  </style>
</head>
<body>
  <h1>SIR Firewall</h1>
  <p class="subtitle">Pre-Inference Governance Audit Certificate</p>

  <div class="badge success" id="score">—</div>

  <div class="box">
    <div class="row"><div class="k">SIR version</div><div id="sir-version" class="mono">—</div></div>
    <div class="row"><div class="k">Suite</div><div id="suite">—</div></div>
    <div class="row"><div class="k">Model</div><div id="model">—</div></div>
    <div class="row"><div class="k">Provider</div><div id="provider">—</div></div>
    <div class="row"><div class="k">Audit timestamp (UTC)</div><div id="date" class="mono">—</div></div>
    <div class="row"><div class="k">Prompts tested</div><div id="prompts">—</div></div>
    <div class="row"><div class="k">Successful leaks</div><div id="leaks">—</div></div>
    <div class="row"><div class="k">Harmless blocked</div><div id="harmless">—</div></div>
    <div class="row"><div class="k">Result</div><div id="result">—</div></div>

    <div style="margin-top:16px;"></div>

    <div class="row"><div class="k">Commit SHA</div><div id="commit" class="mono wrap">—</div></div>
    <div class="row"><div class="k">Payload hash</div><div id="payload-hash" class="mono wrap">—</div></div>
    <div class="row"><div class="k">Policy hash</div><div id="policy-hash" class="mono wrap">—</div></div>
    <div class="row"><div class="k">Suite hash</div><div id="suite-hash" class="mono wrap">—</div></div>
    <div class="row"><div class="k">ITGL final hash</div><div id="itgl-final-hash" class="mono wrap">—</div></div>
  </div>

  <div class="box">
    <strong>Live CI proof</strong><br>
    <a href="#" id="ci-link">GitHub Actions run</a>
    <span class="pill" id="ci-pill" style="display:none;">CI</span>
  </div>

  <div class="box">
    <strong>Cryptographic verification</strong><br>
    Verify the signed JSON with one command from a local checkout of this repo:<br><br>
    <code class="verify mono" id="verify-cmd">curl -s https://raw.githubusercontent.com/SDL-HQ/sir-firewall/main/proofs/latest-audit.json | python tools/verify_certificate.py -</code><br><br>
    <a href="latest-audit.json" id="json-link">Download signed JSON</a>
  </div>

  <div class="box">
    <strong>Safety fingerprint</strong><br>
    <div class="mono wrap" id="safety-fingerprint">—</div>
    <div class="k" style="margin-top:6px;">Deterministic hash over SIR version + policy hash + suite hash + model/provider + results.</div>
  </div>

  <div class="box">
    <strong>Repo</strong><br>
    <a href="#" id="repo-link">—</a>
  </div>

  <footer>
    Issued by SDL – Structural Design Labs<br>
    Cryptographically signed proof · Offline verification · No model calls required
  </footer>

  <script>
    function formatUtcTimestamp(iso) {
      if (!iso) return "—";
      const s = String(iso).trim();
      // Most certs already use ISO like 2026-01-11T05:39:15Z
      if (s.includes("T") && s.endsWith("Z")) {
        return s.replace("T", " ").replace("Z", " UTC");
      }
      // Fallback: try Date parsing
      try {
        const d = new Date(s);
        if (isNaN(d.getTime())) return s;
        return d.toISOString().replace("T", " ").replace(".000Z", " UTC");
      } catch {
        return s;
      }
    }

    function setText(id, val, fallback="—") {
      const el = document.getElementById(id);
      if (!el) return;
      const out = (val === undefined || val === null || String(val).trim() === "") ? fallback : String(val);
      el.textContent = out;
    }

    fetch('latest-audit.json')
      .then(r => r.json())
      .then(data => {
        const leaks = Number(data.jailbreaks_leaked ?? 0);
        const harmless = Number(data.harmless_blocked ?? 0);
        const prompts = Number(data.prompts_tested ?? 0);

        // Repo-aware links (works on forks)
        const repo = data.repository || "SDL-HQ/sir-firewall";
        const repoUrl = `https://github.com/${repo}`;
        const rawJsonUrl = `https://raw.githubusercontent.com/${repo}/main/proofs/latest-audit.json`;

        // Basic fields
        setText("sir-version", data.sir_firewall_version);
        setText("suite", data.suite_name ? data.suite_name : (data.suite_path || "—"));
        setText("model", data.model);
        setText("provider", data.provider);

        // Timestamp (full UTC)
        setText("date", formatUtcTimestamp(data.date));

        setText("prompts", prompts ? String(prompts) : "—");
        setText("leaks", String(leaks));
        setText("harmless", String(harmless));

        // Result + badge
        const ok = leaks === 0 && harmless === 0;
        const scoreEl = document.getElementById("score");
        scoreEl.textContent = `${leaks} / ${prompts || "—"}`;
        scoreEl.className = `badge ${ok ? "success" : "danger"}`;

        const resultEl = document.getElementById("result");
        resultEl.textContent = data.result || (ok ? "AUDIT PASSED" : "AUDIT FAILED");
        resultEl.className = ok ? "success" : "danger";

        // Evidence anchors (human-friendly)
        setText("commit", data.commit_sha);
        setText("payload-hash", data.payload_hash);
        setText("policy-hash", data.policy_hash);
        setText("suite-hash", data.suite_hash);
        setText("itgl-final-hash", data.itgl_final_hash);

        // CI link
        const runUrl = data.ci_run_url || "#";
        const link = document.getElementById("ci-link");
        const pill = document.getElementById("ci-pill");

        link.href = runUrl;

        if (runUrl && runUrl !== "#") {
          const runId = runUrl.split("/").pop() || "";
          // If LOCAL or non-numeric, keep it simple
          if (runId && /^\d+$/.test(runId)) {
            link.textContent = `GitHub Actions run #${runId}`;
          } else if (runId) {
            link.textContent = `GitHub Actions run (${runId})`;
          } else {
            link.textContent = "GitHub Actions run";
          }
          if (pill) pill.style.display = "inline-block";
        } else {
          link.textContent = "GitHub Actions run";
          if (pill) pill.style.display = "none";
        }

        // Verification command (repo-aware, portable)
        const verifyCmd = document.getElementById("verify-cmd");
        verifyCmd.textContent = `curl -s ${rawJsonUrl} | python tools/verify_certificate.py`;

        // JSON download link (local-friendly; still works on pages)
        const jsonLink = document.getElementById("json-link");
        jsonLink.href = "latest-audit.json";

        // Repo link
        const repoLink = document.getElementById("repo-link");
        repoLink.href = repoUrl;
        repoLink.textContent = repoUrl.replace("https://", "");

        // Safety fingerprint
        setText("safety-fingerprint", data.safety_fingerprint);
      })
      .catch(() => {
        document.getElementById("score").textContent = "—";
        const resultEl = document.getElementById("result");
        resultEl.textContent = "Failed to load audit data";
        resultEl.className = "danger";
      });
  </script>
</body>
</html>
<!-- SIR_BUILD: date=2026-01-31T06:57:36Z payload_hash=sha256:cef713d9981b7c66eca269c92afd4d71d6e5ff224d509ab3c29ec08fee6ba82f -->
